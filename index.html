<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TC2 JobId → Join Link</title>
  <meta name="color-scheme" content="dark light" />
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-neutral-950 text-neutral-100">
  <main class="mx-auto max-w-xl p-6">
    <h1 class="text-2xl font-semibold">TC2 JobId → Join Link</h1>
    <p class="text-neutral-400 mt-2">Outputs the exact format Roblox expects.</p>

    <div class="mt-6 rounded-2xl border border-neutral-800 bg-neutral-900/60 p-5 shadow-lg">
      <!-- PlaceId Input -->
      <label for="place" class="block text-sm text-neutral-300 mb-2">PlaceId / GameId</label>
      <input id="place" type="text" class="w-full rounded-xl border border-neutral-700 bg-neutral-950 px-4 py-3 outline-none focus:border-neutral-500 mb-4" placeholder="328028363" />

      <!-- JobId Input -->
      <label for="job" class="block text-sm text-neutral-300 mb-2">Paste JobId or server URL</label>
      <input id="job" type="text" class="w-full rounded-xl border border-neutral-700 bg-neutral-950 px-4 py-3 outline-none focus:border-neutral-500" placeholder="36ccd432-268b-4bb3-9686-0608374357af" />

      <div class="mt-3 flex items-center gap-3">
        <button id="go" class="rounded-xl bg-white/90 px-4 py-2 text-black font-medium hover:bg-white transition">Make link</button>
        <label class="flex items-center gap-2 text-xs text-neutral-400">
          <input id="showProto" type="checkbox" class="accent-white/90">
          Also show roblox:// deep link
        </label>
      </div>

      <div id="err" class="hidden mt-3 rounded-lg border border-red-800/60 bg-red-950/50 px-3 py-2 text-sm text-red-200"></div>

      <div id="out" class="hidden mt-6 space-y-4">
        <div>
          <div class="flex items-center justify-between mb-1">
            <h2 class="text-sm font-semibold text-neutral-300">Browser link (exact format):</h2>
            <div class="flex gap-2">
              <button data-copy="web" class="copy-btn text-xs rounded-lg border border-neutral-700 px-2 py-1 hover:bg-neutral-800">Copy</button>
              <a id="openWeb" class="text-xs rounded-lg bg-white/90 px-2 py-1 text-black font-semibold hover:bg-white" target="_blank" rel="noreferrer">Open</a>
            </div>
          </div>
          <code id="web" class="block break-all rounded-xl bg-neutral-950 p-3 text-xs"></code>
        </div>

        <div id="protoWrap" class="hidden">
          <div class="flex items-center justify-between mb-1">
            <h2 class="text-sm font-semibold text-neutral-300">Deep link (optional):</h2>
            <div class="flex gap-2">
              <button data-copy="proto" class="copy-btn text-xs rounded-lg border border-neutral-700 px-2 py-1 hover:bg-neutral-800">Copy</button>
              <a id="openProto" class="text-xs rounded-lg bg-white/90 px-2 py-1 text-black font-semibold hover:bg-white" target="_self">Open</a>
            </div>
          </div>
          <code id="proto" class="block break-all rounded-xl bg-neutral-950 p-3 text-xs"></code>
        </div>
      </div>
    </div>

    <p class="mt-4 text-xs text-neutral-500">Current PlaceId: <span id="placeDisplay" class="font-mono">328028363</span></p>
  </main>

  <script>
    const $ = (id) => document.getElementById(id);

    const job = $("job");
    const place = $("place");
    const go = $("go");
    const err = $("err");
    const out = $("out");
    const webCode = $("web");
    const openWeb = $("openWeb");
    const protoCode = $("proto");
    const openProto = $("openProto");
    const protoWrap = $("protoWrap");
    const showProto = $("showProto");
    const placeDisplay = $("placeDisplay");

    function extractJobId(s) {
      if (!s) return null;
      const str = String(s).trim();
      const m1 = str.match(/[?&#](?:gameInstanceId|gameId|serverJobId)=([0-9a-fA-F-]{36})/);
      if (m1) return m1[1];
      const m2 = str.match(/\b[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}\b/);
      return m2 ? m2[0] : null;
    }

    function buildWeb(placeId, jobId) {
      return `https://www.roblox.com/games/start?placeId=${placeId}&gameInstanceId=${encodeURIComponent(jobId)}`;
    }

    function buildProto(placeId, jobId) {
      return `roblox://experiences/start?placeId=${placeId}&gameInstanceId=${encodeURIComponent(jobId)}`;
    }

    function showError(msg) {
      err.textContent = msg;
      err.classList.remove("hidden");
      out.classList.add("hidden");
    }

    function clearError() {
      err.classList.add("hidden");
      err.textContent = "";
    }

    function make() {
      clearError();
      const jobId = extractJobId(job.value);
      if (!jobId) return showError("Invalid or missing JobId. Paste a 36-char GUID or a URL containing it.");

      const placeId = place.value.trim();
      if (!placeId.match(/^\d+$/)) return showError("Invalid PlaceId. Must be numeric.");
      placeDisplay.textContent = placeId;

      const web = buildWeb(placeId, jobId);
      webCode.textContent = web;
      openWeb.href = web;

      if (showProto.checked) {
        const proto = buildProto(placeId, jobId);
        protoCode.textContent = proto;
        openProto.href = proto;
        protoWrap.classList.remove("hidden");
      } else {
        protoWrap.classList.add("hidden");
      }

      out.classList.remove("hidden");
    }

    go.addEventListener("click", make);
    job.addEventListener("keydown", (e) => e.key === "Enter" && make());
    place.addEventListener("keydown", (e) => e.key === "Enter" && make());
    showProto.addEventListener("change", () => {
      if (!out.classList.contains("hidden")) make();
    });

    // Copy buttons
    document.addEventListener("click", async (e) => {
      const btn = e.target.closest(".copy-btn");
      if (!btn) return;
      const which = btn.getAttribute("data-copy");
      const text = which === "web" ? webCode.textContent : protoCode.textContent;
      try {
        await navigator.clipboard.writeText(text);
        const prev = btn.textContent;
        btn.textContent = "Copied!";
        setTimeout(() => btn.textContent = prev, 900);
      } catch {
        alert("Clipboard blocked — copy manually.");
      }
    });
  </script>
</body>
</html>
